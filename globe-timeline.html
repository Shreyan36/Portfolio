<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width,initial-scale=1,maximum-scale=1"
  />
  <title>Shreyan • Globe Timeline</title>
  <style>
    :root {
      --bg: #0b0f16;
      --panel: #0f1420;
      --text: #e7ebf2;
      --muted: #a5acc1;
      --brand: #7c4dff;
    }
    html, body { height: 100%; margin: 0; }
    body { background: radial-gradient(1000px 400px at 50% -200px, #141a25 0%, var(--bg) 55%); color: var(--text); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    #app { position: relative; height: 100dvh; overflow: hidden; }

    /* Bottom timeline card */
    .card {
      position: absolute; left: 16px; bottom: 16px;
      background: rgba(15,20,32,.9); border: 1px solid rgba(255,255,255,.06);
      padding: 16px; border-radius: 12px; width: min(460px, calc(100% - 32px));
      box-shadow: 0 8px 30px rgba(0,0,0,.35); backdrop-filter: blur(6px);
    }
    .title { font-weight: 700; margin: 0 0 4px 0; font-size: 16px; }
    .subtitle { margin: 0 0 10px 0; color: var(--muted); font-size: 13px; }
    .btns { display: flex; gap: 8px; justify-content:flex-end; }
    .btn {
      border: 1px solid rgba(255,255,255,.08); background: #171d2a; color: var(--text);
      padding: 8px 12px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px;
    }
    .btn.primary { background: var(--brand); border-color: transparent; color: white; }

    /* Hover card for markers */
    .hover-card {
      position: absolute; pointer-events: none; opacity: 0; transform: translate(-50%, calc(-100% - 14px));
      background: rgba(17,23,36,.92); border: 1px solid rgba(255,255,255,.08); border-radius: 12px;
      width: 260px; box-shadow: 0 10px 30px rgba(0,0,0,.35); transition: opacity .15s ease;
    }
    .hover-card.visible { opacity: 1; }
    .hover-card img { width: 100%; height: 150px; object-fit: cover; border-radius: 12px 12px 0 0; display: block; }
    .hover-card .meta { padding: 10px 12px; }
    .legend {
      position: absolute; top: 12px; right: 12px; display: flex; gap: 10px; background: rgba(17,23,36,.7);
      border: 1px solid rgba(255,255,255,.06); padding: 8px 10px; border-radius: 999px; font-size: 12px; backdrop-filter: blur(6px);
    }
    .dot { width: 8px; height: 8px; border-radius: 999px; display: inline-block; margin-right: 6px; transform: translateY(-1px); }
  </style>
</head>

<body>
  <div id="app">
    <div class="legend">
      <span><span class="dot" style="background:#36d399"></span>Origin</span>
      <span><span class="dot" style="background:#60a5fa"></span>Study</span>
      <span><span class="dot" style="background:#f59e0b"></span>Work</span>
      <span><span class="dot" style="background:#a78bfa"></span>Flight Path</span>
    </div>

    <div id="hoverCard" class="hover-card">
      <img id="hoverImg" src="" alt="">
      <div class="meta">
        <div id="hoverTitle" style="font-weight:700; margin-bottom:4px;"></div>
        <div id="hoverDesc" style="font-size:12px; color:#aab1c6;"></div>
      </div>
    </div>

    <div class="card">
      <div class="title" id="stepTitle">Birth • Burdwan, India</div>
      <div class="subtitle" id="stepDesc">Starting point of the journey.</div>
      <div class="btns">
        <button id="prev" class="btn">Prev</button>
        <button id="next" class="btn primary">Next</button>
      </div>
    </div>
  </div>

  <!-- Globe code -->
  <script type="module">
    import * as THREE from 'https://unpkg.com/three@0.159.0/build/three.module.js';
    import { OrbitControls } from 'https://unpkg.com/three@0.159.0/examples/jsm/controls/OrbitControls.js';

    // ---------- CONFIG: self-hosted assets ----------
    const EARTH_COLOR_URL  = './earth-color.jpg';
    const EARTH_NORMAL_URL = './earth-normal.jpg';

    // Sample images for hover cards (replace anytime)
    const IMG = {
      burdwan: './assets/images/burdwan.jpg',
      nit: './assets/images/nit.jpg',
      buffalo: './assets/images/buffalo.jpg',
      boston: './assets/images/boston.jpg'
    };

    // ---------- TIMELINE CHECKPOINTS ----------
    const checkpoints = [
      {
        id: 'burdwan',
        type: 'origin', color: '#36d399',
        lat: 23.232, lon: 87.861,     // Burdwan
        title: 'Birth • Burdwan, India',
        desc: 'Starting point of the journey.',
        img: IMG.burdwan
      },
      {
        id: 'nit',
        type: 'study', color: '#60a5fa',
        lat: 23.547, lon: 87.291,     // NIT Durgapur
        title: 'Undergrad • NIT Durgapur',
        desc: 'Electronics and Communication Engineering.',
        img: IMG.nit
      },
      {
        id: 'buffalo',
        type: 'study', color: '#60a5fa',
        lat: 42.999, lon: -78.789,    // UB, Buffalo
        title: 'Masters & PhD • University at Buffalo',
        desc: 'Nanophotonics & Biosensing.',
        img: IMG.buffalo
      },
      {
        id: 'boston',
        type: 'work', color: '#f59e0b',
        lat: 42.360, lon: -71.057,    // Boston
        title: 'Internship • Boston, MA',
        desc: 'SEM imaging & process analysis.',
        img: IMG.boston
      }
    ];

    // ---------- THREE BASICS ----------
    const app = document.getElementById('app');
    const hoverCard = document.getElementById('hoverCard');
    const hoverImg = document.getElementById('hoverImg');
    const hoverTitle = document.getElementById('hoverTitle');
    const hoverDesc = document.getElementById('hoverDesc');

    const scene = new THREE.Scene();

    const camera = new THREE.PerspectiveCamera(45, app.clientWidth / app.clientHeight, 0.1, 1000);
    camera.position.set(0, 0, 3.2);

    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.setSize(app.clientWidth, app.clientHeight);
    renderer.outputColorSpace = THREE.SRGBColorSpace;
    app.appendChild(renderer.domElement);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.minDistance = 2.0;
    controls.maxDistance = 6.0;

    // Lights
    scene.add(new THREE.AmbientLight(0xffffff, 0.8));
    const dir = new THREE.DirectionalLight(0xffffff, 1.1);
    dir.position.set(5, 3, 5);
    scene.add(dir);

    // ---------- HELPERS ----------
    function latLonToVec3(lat, lon, radius = 1.0) {
      const phi = (90 - lat) * (Math.PI / 180);
      const theta = (lon + 180) * (Math.PI / 180);
      const x = -radius * Math.sin(phi) * Math.cos(theta);
      const z =  radius * Math.sin(phi) * Math.sin(theta);
      const y =  radius * Math.cos(phi);
      return new THREE.Vector3(x, y, z);
    }

    function makeMarkerTexture(color) {
      const s = 128;
      const c = document.createElement('canvas');
      c.width = c.height = s;
      const g = c.getContext('2d');
      // soft glow
      const grd = g.createRadialGradient(s/2, s/2, 2, s/2, s/2, s/2);
      grd.addColorStop(0, color);
      grd.addColorStop(1, 'rgba(0,0,0,0)');
      g.fillStyle = grd;
      g.beginPath(); g.arc(s/2, s/2, s/2, 0, Math.PI*2); g.fill();
      // core dot
      g.fillStyle = '#fff';
      g.beginPath(); g.arc(s/2, s/2, 6, 0, Math.PI*2); g.fill();
      return new THREE.CanvasTexture(c);
    }

    // ---------- INIT ----------
    async function initGlobe() {
      const loader = new THREE.TextureLoader();
      const [colorTex, normalTex] = await Promise.all([
        loader.loadAsync(EARTH_COLOR_URL),
        loader.loadAsync(EARTH_NORMAL_URL)
      ]);
      colorTex.anisotropy  = renderer.capabilities.getMaxAnisotropy();
      normalTex.anisotropy = renderer.capabilities.getMaxAnisotropy();

      const globeMat = new THREE.MeshStandardMaterial({
        map: colorTex,
        normalMap: normalTex,
        roughness: 0.9,
        metalness: 0.05
      });

      const globeGeo = new THREE.SphereGeometry(1, 96, 96);
      const globe = new THREE.Mesh(globeGeo, globeMat);
      scene.add(globe);

      // Markers
      const markerGroup = new THREE.Group();
      scene.add(markerGroup);

      const markerSprites = [];
      checkpoints.forEach(cp => {
        const tex = makeMarkerTexture(cp.color);
        const mat = new THREE.SpriteMaterial({ map: tex, depthTest: false, depthWrite: false, transparent: true });
        const sprite = new THREE.Sprite(mat);
        const pos = latLonToVec3(cp.lat, cp.lon, 1.002);
        sprite.position.copy(pos);
        sprite.scale.set(0.08, 0.08, 0.08);
        sprite.userData = { ...cp };
        markerGroup.add(sprite);
        markerSprites.push(sprite);
      });

      // Raycaster for hover
      const raycaster = new THREE.Raycaster();
      const mouse = new THREE.Vector2();

      function onMove(e) {
        const rect = renderer.domElement.getBoundingClientRect();
        mouse.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
        mouse.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;

        raycaster.setFromCamera(mouse, camera);
        const hits = raycaster.intersectObjects(markerSprites, false);
        if (hits.length) {
          const obj = hits[0].object;
          const { title, desc, img } = obj.userData;

          hoverImg.src = img;
          hoverTitle.textContent = title;
          hoverDesc.textContent = desc;

          // project 3D to 2D
          const p = obj.position.clone().project(camera);
          const sx = (p.x * 0.5 + 0.5) * rect.width + rect.left;
          const sy = (-p.y * 0.5 + 0.5) * rect.height + rect.top;

          hoverCard.style.left = `${sx}px`;
          hoverCard.style.top  = `${sy}px`;
          hoverCard.classList.add('visible');
        } else {
          hoverCard.classList.remove('visible');
        }
      }
      renderer.domElement.addEventListener('mousemove', onMove);

      // Timeline controls (simple camera tween)
      let step = 0;
      const stepTitle = document.getElementById('stepTitle');
      const stepDesc  = document.getElementById('stepDesc');
      const prevBtn   = document.getElementById('prev');
      const nextBtn   = document.getElementById('next');

      function updateUI() {
        stepTitle.textContent = checkpoints[step].title;
        stepDesc.textContent  = checkpoints[step].desc;
      }
      updateUI();

      function flyTo(lat, lon, dist = 3.0, ms = 1200) {
        // target camera position slightly offset from marker normal
        const t = latLonToVec3(lat, lon, dist);
        const start = camera.position.clone();
        const end = t;
        const startTime = performance.now();

        function animateFly(now) {
          const k = Math.min(1, (now - startTime) / ms);
          const s = 0.5 - 0.5 * Math.cos(k * Math.PI); // easeInOut
          camera.position.lerpVectors(start, end, s);
          controls.target.lerpVectors(controls.target, latLonToVec3(lat, lon, 0), s);
          if (k < 1) requestAnimationFrame(animateFly);
        }
        requestAnimationFrame(animateFly);
      }

      prevBtn.onclick = () => {
        step = (step - 1 + checkpoints.length) % checkpoints.length;
        updateUI();
        const { lat, lon } = checkpoints[step];
        flyTo(lat, lon);
      };
      nextBtn.onclick = () => {
        step = (step + 1) % checkpoints.length;
        updateUI();
        const { lat, lon } = checkpoints[step];
        flyTo(lat, lon);
      };

      // Start centered on first checkpoint
      flyTo(checkpoints[0].lat, checkpoints[0].lon, 3.2, 800);

      // Render loop
      function tick() {
        controls.update();
        renderer.render(scene, camera);
        requestAnimationFrame(tick);
      }
      tick();
    }

    // Handle resize
    function onResize() {
      const w = app.clientWidth, h = app.clientHeight;
      camera.aspect = w / h;
      camera.updateProjectionMatrix();
      renderer.setSize(w, h);
    }
    window.addEventListener('resize', onResize);

    // Boot
    initGlobe().catch(err => {
      console.error('Globe init failed:', err);
      const fallback = document.createElement('div');
      fallback.style.position = 'absolute';
      fallback.style.inset = '0';
      fallback.style.display = 'grid';
      fallback.style.placeItems = 'center';
      fallback.style.color = '#aab1c6';
      fallback.textContent = 'Failed to load globe assets. Check console and asset paths.';
      app.appendChild(fallback);
    });
  </script>
</body>
</html>
