<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Shreyan • Map Timeline</title>

<!-- Leaflet (no API key) -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
  :root{
    --bg:#0b1020; --panel:#0f162b; --panel2:#0c1426; --text:#e5e7eb; --muted:#a8b3cf;
    --origin:#14b8a6; --study:#60a5fa; --work:#f59e0b; --flight:#8b5cf6; --accent:#8b5cf6;
  }
  *{box-sizing:border-box} html,body{height:100%;margin:0;background:var(--bg);color:var(--text);
    font:14px/1.45 system-ui, -apple-system, "Segoe UI", Roboto, Inter, Arial}
  #map{position:fixed; inset:0}
  .legend{position:fixed; top:12px; right:12px; z-index:5000; display:flex; gap:12px; background:rgba(15,22,43,.65);
    border:1px solid rgba(255,255,255,.08); padding:8px 12px; border-radius:14px; backdrop-filter: blur(8px)}
  .lg{display:flex; align-items:center; gap:6px; color:var(--muted)}
  .dot{width:8px; height:8px; border-radius:50%}
  .card{position:fixed; left:16px; bottom:16px; z-index:5000; width:min(560px, calc(100% - 32px)); background:rgba(15,22,43,.85);
        border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:16px; backdrop-filter: blur(8px)}
  .row{display:flex; align-items:center; gap:8px; margin-bottom:6px}
  .h{font-weight:700; margin:0}
  .t{color:#cfe0ff; margin:4px 0 8px}
  .d{color:var(--muted)}
  .controls{display:flex; gap:10px; margin-top:10px}
  .btn{background:#1b2442; color:#e6eaff; border:1px solid rgba(255,255,255,.08); padding:8px 14px; border-radius:12px; cursor:pointer}
  .btn.primary{background:linear-gradient(135deg,#6d28d9,#8b5cf6); border:0}
  .btn:disabled{opacity:.5; cursor:not-allowed}

  /* hover preview */
  .hover{position:fixed; z-index:6000; display:none; width:240px; transform:translate(-50%,-120%);
         background:rgba(15,22,43,.95); border:1px solid rgba(255,255,255,.08); border-radius:12px; overflow:hidden;
         box-shadow:0 12px 36px rgba(0,0,0,.45)}
  .hover img{display:block; width:100%; height:140px; object-fit:cover}
  .hover .hx{padding:8px 10px; color:#dbe7ff}
  a,a:visited{color:#c6b4ff}
</style>
</head>
<body>

<div id="map" aria-label="Infinite scrolling map timeline"></div>

<!-- legend -->
<div class="legend">
  <div class="lg"><span class="dot" style="background:var(--origin)"></span>Origin</div>
  <div class="lg"><span class="dot" style="background:var(--study)"></span>Study</div>
  <div class="lg"><span class="dot" style="background:var(--work)"></span>Work</div>
  <div class="lg"><span class="dot" style="background:var(--flight)"></span>Flight Path</div>
</div>

<!-- bottom info card -->
<div class="card">
  <div class="row">
    <div id="typeDot" class="dot" style="background:var(--origin)"></div>
    <div id="title" class="h">Birth • Burdwan, India</div>
  </div>
  <div id="subtitle" class="t">Starting point of the journey.</div>
  <div id="desc" class="d">Use Next to follow the path.</div>
  <div class="controls">
    <button id="prev" class="btn">Prev</button>
    <button id="next" class="btn primary">Next</button>
  </div>
</div>

<!-- hover preview -->
<div id="hover" class="hover">
  <img id="hoverImg" alt="">
  <div id="hoverTxt" class="hx"></div>
</div>

<script>
/* --------------------- Data --------------------- */
const steps = [
  {
    id:'birth', type:'origin', title:'Birth • Burdwan, India',
    subtitle:'Starting point of the journey.',
    desc:'Burdwan (Bardhaman), West Bengal.',
    lat:23.2324, lon:87.8615, preview: sampleImage(1)
  },
  {
    id:'school', type:'origin', title:'School • Burdwan, India',
    subtitle:'Early education.',
    desc:'Formative years and first sparks of science.',
    lat:23.2324, lon:87.8615, preview: sampleImage(2)
  },
  {
    id:'nit', type:'study', title:'Undergrad • NIT Durgapur',
    subtitle:'Electronics & Communication Engineering',
    desc:'NIT Durgapur, West Bengal, India.',
    lat:23.5505, lon:87.291, preview: sampleImage(3)
  },
  {
    id:'ub', type:'study', title:'MS & PhD • University at Buffalo',
    subtitle:'Nanophotonics & Biosensing',
    desc:'SUNY Buffalo, New York, USA.',
    lat:42.999, lon:-78.78, preview: sampleImage(4)
  },
  {
    id:'boston', type:'work', title:'Internship • Boston, USA',
    subtitle:'Summer at a meta-optics company',
    desc:'Hands-on SEM imaging and process analysis.',
    lat:42.3601, lon:-71.0589, preview: sampleImage(5)
  }
];

const typeColor = (t)=> t==='origin' ? '#14b8a6' : t==='study' ? '#60a5fa' : '#f59e0b';

/* --------------------- Map --------------------- */
const map = L.map('map', {
  worldCopyJump: true,               // infinite horizontal wrap
  zoomControl: false,                // we’ll keep it clean
  minZoom: 2, maxZoom: 18,
  center: [20, 78], zoom: 4
});

// OSM tiles (no key)
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution:'© OpenStreetMap',
  noWrap:false
}).addTo(map);

// A subtle zoom control in bottom-right (optional)
L.control.zoom({ position:'bottomright' }).addTo(map);

/* --------------------- Pins + Hover --------------------- */
const hover = document.getElementById('hover');
const hoverImg = document.getElementById('hoverImg');
const hoverTxt = document.getElementById('hoverTxt');

const pinLayer = L.layerGroup().addTo(map);
const markers = [];

steps.forEach((s)=>{
  const icon = L.divIcon({
    className:'pin',
    html:`<div style="width:14px;height:14px;border-radius:50%;background:${typeColor(s.type)};border:2px solid #0b1020;box-shadow:0 0 0 2px rgba(255,255,255,.15)"></div>`,
    iconSize:[14,14], iconAnchor:[7,7]
  });
  const m = L.marker([s.lat, s.lon], { icon }).addTo(pinLayer);
  m.step = s;

  m.on('mouseover', (e)=>{
    hoverImg.src = s.preview;
    hoverTxt.textContent = s.title;
    hover.style.display = 'block';
    const p = map.latLngToContainerPoint(e.latlng);
    hover.style.left = p.x + 'px';
    hover.style.top  = p.y + 'px';
  });
  m.on('mousemove', (e)=>{
    const p = map.latLngToContainerPoint(e.latlng);
    hover.style.left = p.x + 'px';
    hover.style.top  = p.y + 'px';
  });
  m.on('mouseout', ()=>{ hover.style.display='none'; });

  markers.push(m);
});

/* --------------------- Flight path + plane --------------------- */
const flightLayer = L.layerGroup().addTo(map);
let plane = null;

function drawFlight(a, b){
  flightLayer.clearLayers();
  if (plane) plane.remove();

  // great-circle-ish polyline by interpolating a few points
  const pts = interpolateLatLngs(a, b, 96);
  const path = L.polyline(pts, { color:'#8b5cf6', weight:2, opacity:0.9 }).addTo(flightLayer);

  // plane marker
  const planeIcon = L.divIcon({
    className:'plane',
    html:`<div style="width:10px;height:10px;border-radius:50%;background:#fff;box-shadow:0 0 10px #fff"></div>`,
    iconSize:[10,10], iconAnchor:[5,5]
  });
  plane = L.marker(pts[0], { icon: planeIcon }).addTo(flightLayer);

  // animate
  let i = 0;
  (function tick(){
    i = (i + 1) % pts.length;
    plane.setLatLng(pts[i]);
    plane._icon.style.transform += ' rotate(0.0001turn)'; // force repaint on some browsers
    plane._icon.style.transition = 'transform 40ms linear';
    requestAnimationFrame(tick);
  })();
}

function interpolateLatLngs(a, b, n=64){
  const lat1 = a.lat * Math.PI/180, lon1 = a.lng * Math.PI/180;
  const lat2 = b.lat * Math.PI/180, lon2 = b.lng * Math.PI/180;
  const d = 2 * Math.asin(Math.sqrt(
      Math.sin((lat2-lat1)/2)**2 + Math.cos(lat1)*Math.cos(lat2)*Math.sin((lon2-lon1)/2)**2
  ));
  if (d===0) return [a,b];
  const res = [];
  for (let i=0;i<=n;i++){
    const f = i/n;
    const A = Math.sin((1-f)*d)/Math.sin(d);
    const B = Math.sin(f*d)/Math.sin(d);
    const x = A*Math.cos(lat1)*Math.cos(lon1) + B*Math.cos(lat2)*Math.cos(lon2);
    const y = A*Math.cos(lat1)*Math.sin(lon1) + B*Math.cos(lat2)*Math.sin(lon2);
    const z = A*Math.sin(lat1)               + B*Math.sin(lat2);
    const lat = Math.atan2(z, Math.sqrt(x*x + y*y));
    const lon = Math.atan2(y, x);
    res.push(L.latLng(lat*180/Math.PI, lon*180/Math.PI));
  }
  return res;
}

/* --------------------- Sequencing --------------------- */
const typeDot = document.getElementById('typeDot');
const title = document.getElementById('title');
const subtitle = document.getElementById('subtitle');
const desc = document.getElementById('desc');
const btnPrev = document.getElementById('prev');
const btnNext = document.getElementById('next');

let idx = 0;
setStep(0, false);

btnPrev.onclick = ()=> setStep(idx-1);
btnNext.onclick = ()=> setStep(idx+1);

function setStep(i, animate=true){
  idx = Math.max(0, Math.min(steps.length-1, i));
  const s = steps[idx];
  typeDot.style.background = typeColor(s.type);
  title.textContent = s.title;
  subtitle.textContent = s.subtitle;
  desc.textContent = s.desc;

  const latlng = L.latLng(s.lat, s.lon);
  map.flyTo(latlng, 6, { duration: 1.2 });

  if (idx>0){
    drawFlight(L.latLng(steps[idx-1].lat, steps[idx-1].lon), latlng);
  } else {
    flightLayer.clearLayers();
  }

  btnPrev.disabled = idx===0;
  btnNext.disabled = idx===steps.length-1;
}

/* --------------------- Inline placeholder images --------------------- */
function sampleImage(n){
  const stops = [
    ['#0ea5e9','#1e3a8a'],
    ['#22c55e','#0f766e'],
    ['#f59e0b','#b45309'],
    ['#8b5cf6','#4c1d95'],
    ['#ef4444','#7f1d1d'],
  ];
  const [a,b]=stops[(n-1)%stops.length];
  const svg = encodeURIComponent(
`<svg xmlns='http://www.w3.org/2000/svg' width='720' height='480'>
  <defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>
    <stop offset='0%' stop-color='${a}'/><stop offset='100%' stop-color='${b}'/></linearGradient></defs>
  <rect width='100%' height='100%' fill='url(#g)'/>
  <circle cx='360' cy='240' r='140' fill='rgba(255,255,255,0.08)'/>
  <text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle'
        font-family='system-ui,Arial' font-size='28' fill='rgba(255,255,255,0.92)'>Shreyan • Preview ${n}</text>
</svg>`);
  return `data:image/svg+xml;charset=utf-8,${svg}`;
}

/* --------------------- Replace previews later --------------------- */
/* Example:
   steps[0].preview = "./images/burdwan.jpg";
   steps[3].preview = "./images/ubuffalo-lab.jpg";
*/
</script>
</body>
</html>
