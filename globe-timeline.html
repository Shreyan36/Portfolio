<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Shreyan • Map Timeline (City Zoom)</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
  :root{
    --bg:#0c1020; --panel:#0f162b; --text:#e8ecf8; --muted:#a9b2c9;
    --origin:#14b8a6; --study:#60a5fa; --work:#f59e0b;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);
    font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
  #map{position:fixed; inset:0}

  .hud{position:fixed; left:16px; bottom:16px; z-index:5000;
       width:min(560px,calc(100% - 32px)); background:rgba(15,22,43,.86);
       border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:14px;
       backdrop-filter:blur(8px)}
  .row{display:flex;align-items:center;gap:10px}
  .dot{width:12px;height:12px;border-radius:50%}
  .title{font-weight:700}
  .sub{color:#cfe0ff;margin:4px 0 6px}
  .desc{color:var(--muted)}
  .controls{display:flex;gap:10px;margin-top:10px}
  .btn{background:#1b2442;color:#e6eaff;border:1px solid rgba(255,255,255,.08);
       padding:8px 14px;border-radius:12px;cursor:pointer}
  .btn.primary{background:linear-gradient(135deg,#6d28d9,#8b5cf6);border:0}
  .btn:disabled{opacity:.5;cursor:not-allowed}

  .legend{position:fixed; top:12px; right:12px; z-index:5000; display:flex; gap:12px;
    background:rgba(15,22,43,.65); border:1px solid rgba(255,255,255,.08);
    padding:8px 12px; border-radius:14px; backdrop-filter:blur(8px)}
  .lg{display:flex; align-items:center; gap:6px; color:#cdd8f0}

  .leaflet-marker-icon.pin:hover{filter: drop-shadow(0 0 8px rgba(255,255,255,.5))}
</style>
</head>
<body>
  <div id="map" aria-label="Satellite map timeline"></div>

  <div class="legend">
    <div class="lg"><span class="dot" style="background:#14b8a6"></span>Origin</div>
    <div class="lg"><span class="dot" style="background:#60a5fa"></span>Study</div>
    <div class="lg"><span class="dot" style="background:#f59e0b"></span>Work</div>
  </div>

  <div class="hud">
    <div class="row">
      <div id="typeDot" class="dot" style="background:#14b8a6"></div>
      <div id="title" class="title">Birth • Burdwan, India</div>
    </div>
    <div id="subtitle" class="sub">Starting point of the journey.</div>
    <div id="desc" class="desc">Use Next to follow the path. Click a pin to zoom into that city.</div>
    <div class="controls">
      <button id="prev" class="btn">Prev</button>
      <button id="next" class="btn primary">Next</button>
    </div>
  </div>

<script>
/* ------------ Data (tune radiusKm to control how much city is visible) ------------ */
const steps = [
  { id:'birth',  type:'origin', title:'Birth • Burdwan, India',
    subtitle:'Starting point of the journey.', desc:'Burdwan (Bardhaman), West Bengal.',
    lat:23.2324, lon:87.8615, radiusKm:10 },
  { id:'school', type:'origin', title:'School • Burdwan, India',
    subtitle:'Early education.', desc:'Formative years and first sparks of science.',
    lat:23.2324, lon:87.8615, radiusKm:10 },
  { id:'nit',    type:'study',  title:'Undergrad • NIT Durgapur',
    subtitle:'Electronics & Communication Engineering', desc:'NIT Durgapur, West Bengal.',
    lat:23.5505, lon:87.2910, radiusKm:12 },
  { id:'ub',     type:'study',  title:'MS & PhD • University at Buffalo',
    subtitle:'Nanophotonics & Biosensing', desc:'SUNY Buffalo, New York.',
    lat:42.9990, lon:-78.7800, radiusKm:20 },
  { id:'boston', type:'work',   title:'Internship • Boston, USA',
    subtitle:'Summer at a meta‑optics company', desc:'Hands‑on SEM & process analysis.',
    lat:42.3601, lon:-71.0589, radiusKm:18 }
];
const typeColor = t => t==='origin' ? '#14b8a6' : (t==='study' ? '#60a5fa' : '#f59e0b');

/* ---------------- Map: satellite tiles, no extra labels ---------------- */
const map = L.map('map', {
  center:[20,78], zoom:4, minZoom:2, maxZoom:19,
  zoomControl:false, worldCopyJump:true, zoomAnimation:true, inertia:true
});
L.control.zoom({ position:'bottomright' }).addTo(map);
L.tileLayer(
  'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
  { attribution:'Tiles © Esri — Source: Esri, Maxar, Earthstar Geographics', crossOrigin:true }
).addTo(map);

/* ---------------- Pins ---------------- */
const pinLayer = L.layerGroup().addTo(map);
steps.forEach(s=>{
  const icon = L.divIcon({
    className:'pin',
    html:`<div style="width:16px;height:16px;border-radius:50%;
                  background:${typeColor(s.type)};
                  border:2px solid #0c1020; box-shadow:0 0 0 2px rgba(255,255,255,.18)"></div>`,
    iconSize:[16,16], iconAnchor:[8,8]
  });
  const m = L.marker([s.lat, s.lon], {icon}).addTo(pinLayer);
  m.on('click', ()=> focusCity(s));
});

/* ---------------- HUD + sequencing ---------------- */
const typeDot = document.getElementById('typeDot');
const titleEl = document.getElementById('title');
const subEl   = document.getElementById('subtitle');
const descEl  = document.getElementById('desc');
const prevBtn = document.getElementById('prev');
const nextBtn = document.getElementById('next');

let idx = 0;
setHUD(steps[0]);
fitCity(steps[0]); // first load: just zoom to first stop

prevBtn.onclick = ()=> goTo(idx-1);
nextBtn.onclick = ()=> goTo(idx+1);

function goTo(newIndex){
  idx = Math.max(0, Math.min(steps.length-1, newIndex));
  const s = steps[idx];
  setHUD(s);
  sequenceToCity(s).catch(()=>{});
  prevBtn.disabled = idx===0;
  nextBtn.disabled = idx===steps.length-1;
}
function setHUD(s){
  typeDot.style.background = typeColor(s.type);
  titleEl.textContent = s.title;
  subEl.textContent   = s.subtitle;
  descEl.textContent  = s.desc;
}

/* ---------------- Animation: zoom‑out → fly → zoom‑in ---------------- */
const OUT_ZOOM = 3.5, OUT_DUR = 0.9, IN_DUR = 1.6;

function once(target, event){
  return new Promise(resolve => target.once(event, resolve));
}
async function sequenceToCity(s){
  map.stop(); // cancel any ongoing animation

  // Step 1: zoom out a bit (only if we’re currently close)
  if (map.getZoom() > OUT_ZOOM + 0.1){
    map.flyTo(map.getCenter(), OUT_ZOOM, {duration: OUT_DUR, animate:true});
    await once(map, 'zoomend');
  }

  // Step 2: glide to new city at OUT_ZOOM
  map.flyTo([s.lat, s.lon], OUT_ZOOM, {duration: OUT_DUR, animate:true});
  await once(map, 'moveend');

  // Step 3: force a proper city zoom
  await fitCity(s);
}

/* ---- FIXED city zoom: compute best zoom from bounds, then fly to center at that zoom ---- */
function fitCity(s){
  return new Promise(resolve=>{
    const circle  = L.circle([s.lat, s.lon], { radius: (s.radiusKm || 12) * 1000 });
    const bounds  = circle.getBounds();
    const padding = [60, 60];

    // Ask Leaflet the zoom that would fit these bounds
    let desired = map.getBoundsZoom(bounds, true, padding);

    // Clamp to a nice “city level” range; tweak as desired
    desired = Math.min(Math.max(desired, 12), 14);

    // Now fly directly to the center at the computed zoom (ensures real zoom‑in)
    map.flyTo([s.lat, s.lon], desired, { duration: IN_DUR, animate: true });
    map.once('moveend', resolve);
  });
}

/* --------------- Optional: keyboard nav (←/→) ---------------- */
window.addEventListener('keydown', e=>{
  if (e.key==='ArrowRight') nextBtn.click();
  if (e.key==='ArrowLeft')  prevBtn.click();
});
</script>
</body>
</html>
