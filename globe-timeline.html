<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width,initial-scale=1,maximum-scale=1"
  />
  <title>Shreyan • Globe Timeline</title>
  <style>
    :root {
      --bg: #0b0f16;
      --panel: #0f1420;
      --text: #e7ebf2;
      --muted: #a5acc1;
      --brand: #7c4dff;
    }
    html, body { height: 100%; margin: 0; }
    body { background: radial-gradient(1000px 400px at 50% -200px, #141a25 0%, var(--bg) 55%); color: var(--text); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    #app { position: relative; height: 100dvh; overflow: hidden; }

    /* Bottom timeline card */
    .card {
      position: absolute; left: 16px; bottom: 16px;
      background: rgba(15,20,32,.9); border: 1px solid rgba(255,255,255,.06);
      padding: 16px; border-radius: 12px; width: min(460px, calc(100% - 32px));
      box-shadow: 0 8px 30px rgba(0,0,0,.35); backdrop-filter: blur(6px);
    }
    .title { font-weight: 700; margin: 0 0 4px 0; font-size: 16px; }
    .subtitle { margin: 0 0 10px 0; color: var(--muted); font-size: 13px; }
    .btns { display: flex; gap: 8px; justify-content:flex-end; }
    .btn {
      border: 1px solid rgba(255,255,255,.08); background: #171d2a; color: var(--text);
      padding: 8px 12px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px;
    }
    .btn.primary { background: var(--brand); border-color: transparent; color: white; }

    /* Hover card for markers */
    .hover-card {
      position: absolute; pointer-events: none; opacity: 0; transform: translate(-50%, calc(-100% - 14px));
      background: rgba(17,23,36,.92); border: 1px solid rgba(255,255,255,.08); border-radius: 12px;
      width: 260px; box-shadow: 0 10px 30px rgba(0,0,0,.35); transition: opacity .15s ease;
    }
    .hover-card.visible { opacity: 1; }
    .hover-card img { width: 100%; height: 150px; object-fit: cover; border-radius: 12px 12px 0 0; display: block; }
    .hover-card .meta { padding: 10px 12px; }
    .legend {
      position: absolute; top: 12px; right: 12px; display: flex; gap: 10px; background: rgba(17,23,36,.7);
      border: 1px solid rgba(255,255,255,.06); padding: 8px 10px; border-radius: 999px; font-size: 12px; backdrop-filter: blur(6px);
    }
    .dot { width: 8px; height: 8px; border-radius: 999px; display: inline-block; margin-right: 6px; transform: translateY(-1px); }
  </style>
</head>

<body>
  <div id="app">
    <div class="legend">
      <span><span class="dot" style="background:#36d399"></span>Origin</span>
      <span><span class="dot" style="background:#60a5fa"></span>Study</span>
      <span><span class="dot" style="background:#f59e0b"></span>Work</span>
      <span><span class="dot" style="background:#a78bfa"></span>Flight Path</span>
    </div>

    <div id="hoverCard" class="hover-card">
      <img id="hoverImg" src="" alt="">
      <div class="meta">
        <div id="hoverTitle" style="font-weight:700; margin-bottom:4px;"></div>
        <div id="hoverDesc" style="font-size:12px; color:#aab1c6;"></div>
      </div>
    </div>

    <div class="card">
      <div class="title" id="stepTitle">Birth • Burdwan, India</div>
      <div class="subtitle" id="stepDesc">Starting point of the journey.</div>
      <div class="btns">
        <button id="prev" class="btn">Prev</button>
        <button id="next" class="btn primary">Next</button>
      </div>
    </div>
  </div>

  <!-- Globe code -->
 <script type="module">
/* --------- Robust Three.js + OrbitControls imports (ESM, safe for GH Pages) --------- */
import * as THREE from 'https://unpkg.com/three@0.159.0/build/three.module.js';
import { OrbitControls } from 'https://unpkg.com/three@0.159.0/examples/jsm/controls/OrbitControls.js';

/* ---------------------- DOM targets & basic layout ---------------------- */
const container = document.getElementById('globe-container') || (() => {
  const c = document.createElement('div');
  c.id = 'globe-container';
  c.style.position = 'fixed';
  c.style.inset = '0';
  c.style.zIndex = '0';   // your UI sits above this
  document.body.appendChild(c);
  return c;
})();
container.innerHTML = ''; // clear if reloaded

/* ---------------------- Self-hosted assets (repo root) ---------------------- */
const EARTH_COLOR_URL  = './earth-color.jpg';
const EARTH_NORMAL_URL = './earth-normal.jpg';
const IMG = {
  burdwan: './burdwan.jpg',
  nit: './nit.jpg',
  buffalo: './buffalo.jpg',
  boston: './boston.jpg'
};

/* ---------------------- Basic Three.js scene ---------------------- */
const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
renderer.setSize(window.innerWidth, window.innerHeight);
container.appendChild(renderer.domElement);

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 2000);
camera.position.set(0, 0, 6);

const controls = new OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.enablePan = false;
controls.minDistance = 3;
controls.maxDistance = 12;

/* Lighting */
scene.add(new THREE.AmbientLight(0xffffff, 0.8));
const dir = new THREE.DirectionalLight(0xffffff, 0.8);
dir.position.set(5, 3, 5);
scene.add(dir);

/* ---------------------- Globe (with texture fallback) ---------------------- */
const sphere = new THREE.Mesh(
  new THREE.SphereGeometry(2, 128, 128),
  new THREE.MeshStandardMaterial({ color: 0x223355, roughness: 0.8, metalness: 0.0 })
);
scene.add(sphere);

const loader = new THREE.TextureLoader();

function loadTexture(url) {
  return new Promise((resolve, reject) => {
    const tex = loader.load(
      url,
      () => resolve(tex),
      undefined,
      (err) => reject(err)
    );
  });
}

(async () => {
  try {
    console.log('Loading textures:', EARTH_COLOR_URL, EARTH_NORMAL_URL);
    const [colorTex, normalTex] = await Promise.all([
      loadTexture(EARTH_COLOR_URL),
      loadTexture(EARTH_NORMAL_URL),
    ]);

    colorTex.colorSpace = THREE.SRGBColorSpace;
    normalTex.wrapS = normalTex.wrapT = THREE.RepeatWrapping;

    sphere.material.map = colorTex;
    sphere.material.normalMap = normalTex;
    sphere.material.roughness = 0.7;
    sphere.material.needsUpdate = true;
    console.log('✅ Textures applied');
  } catch (e) {
    console.warn('⚠️ Texture load failed, using fallback material. Check 404 in Network tab.', e);
  }
})();

/* ---------------------- Pins + hover image cards ---------------------- */
const pinMaterial = new THREE.MeshBasicMaterial({ color: 0x7c3aed }); // purple
function lonLatToVector3(lon, lat, radius = 2.02) {
  const phi = (90 - lat) * (Math.PI/180);
  const theta = (lon + 180) * (Math.PI/180);
  return new THREE.Vector3(
    -radius * Math.sin(phi) * Math.cos(theta),
     radius * Math.cos(phi),
     radius * Math.sin(phi) * Math.sin(theta)
  );
}

// Your timeline points
const POINTS = [
  { key:'burdwan', label:'Birth • Burdwan, India', lon:87.855,  lat:23.232,   img:IMG.burdwan, type:'origin' },
  { key:'nit',     label:'Undergrad • NIT Durgapur', lon:87.290,  lat:23.547,   img:IMG.nit,     type:'study'  },
  { key:'buffalo', label:'Graduate • Buffalo, USA', lon:-78.878, lat:42.886,   img:IMG.buffalo, type:'study'  },
  { key:'boston',  label:'Internship • Boston, USA', lon:-71.058, lat:42.360,   img:IMG.boston,  type:'work'   },
];

const pins = [];
POINTS.forEach(p => {
  const geom = new THREE.SphereGeometry(0.03, 16, 16);
  const m = pinMaterial.clone();
  if (p.type==='origin') m.color.set(0x14b8a6); // teal
  if (p.type==='study')  m.color.set(0x60a5fa); // blue
  if (p.type==='work')   m.color.set(0xf59e0b); // amber
  const mesh = new THREE.Mesh(geom, m);
  mesh.position.copy(lonLatToVector3(p.lon, p.lat));
  mesh.userData = p;
  scene.add(mesh);
  pins.push(mesh);
});

/* Hover image card (follows mouse) */
const hoverCard = document.createElement('div');
hoverCard.style.position = 'fixed';
hoverCard.style.pointerEvents = 'none';
hoverCard.style.transform = 'translate(-50%, -110%)';
hoverCard.style.borderRadius = '12px';
hoverCard.style.overflow = 'hidden';
hoverCard.style.boxShadow = '0 10px 30px rgba(0,0,0,.45)';
hoverCard.style.display = 'none';
hoverCard.innerHTML = `
  <img id="hover-img" src="" style="width:240px;height:140px;object-fit:cover;display:block;" />
  <div style="background:#0b1020;color:#cbd5e1;padding:8px 10px;font:600 12px/1 Inter,system-ui">.</div>`;
document.body.appendChild(hoverCard);
const hoverImg = hoverCard.querySelector('#hover-img');
const hoverCaption = hoverCard.querySelector('div');

const raycaster = new THREE.Raycaster();
const mouse = new THREE.Vector2();

function onPointerMove(e) {
  const rect = renderer.domElement.getBoundingClientRect();
  mouse.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
  mouse.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;

  raycaster.setFromCamera(mouse, camera);
  const hit = raycaster.intersectObjects(pins, true)[0];
  if (hit) {
    const p = hit.object.userData;
    hoverImg.src = p.img;
    hoverCaption.textContent = p.label;
    hoverCard.style.left = e.clientX + 'px';
    hoverCard.style.top  = e.clientY + 'px';
    hoverCard.style.display = 'block';
  } else {
    hoverCard.style.display = 'none';
  }
}
renderer.domElement.addEventListener('mousemove', onPointerMove);

/* ---------------------- Animate ---------------------- */
function resize() {
  const w = window.innerWidth, h = window.innerHeight;
  camera.aspect = w / h;
  camera.updateProjectionMatrix();
  renderer.setSize(w, h, false);
}
window.addEventListener('resize', resize);

function tick() {
  sphere.rotation.y += 0.0008; // slow auto-rotate
  controls.update();
  renderer.render(scene, camera);
  requestAnimationFrame(tick);
}
resize();
tick();

/* ---------------------- Small helpers for your bottom UI ---------------------- */
// If you have Next/Prev buttons wired, you can program a camera flight here:
window.flyTo = (lon, lat, altitude=6) => {
  const target = lonLatToVector3(lon, lat, 2.2);
  controls.target.lerp(target, 0.1);
  camera.position.lerp(target.clone().setLength(altitude), 0.1);
};
</script>

</body>
</html>
